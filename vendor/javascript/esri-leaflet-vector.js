// esri-leaflet-vector@4.2.5 downloaded from https://ga.jspm.io/npm:esri-leaflet-vector@4.2.5/dist/esri-leaflet-vector-debug.js

import*as t from"esri-leaflet";import*as e from"leaflet";import*as i from"maplibre-gl";var s=t;try{"default"in t&&(s=t.default)}catch(t){}var o=e;try{"default"in e&&(o=e.default)}catch(t){}var n=i;try{"default"in i&&(n=i.default)}catch(t){}var a=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var r={};(function(t,e){e(r,s,o,n)})(0,(function(t,e,i,s){function _interopDefaultLegacy(t){return t&&typeof t==="object"&&"default"in t?t:{default:t}}var o=_interopDefaultLegacy(s);var n="esri-leaflet-vector";var r="Esri vector basemap and vector tile layer plugin for Leaflet.";var l="4.2.5";var p="John Gravois (https://johngravois.com)";var c=["Patrick Arlt <parlt@esri.com> (http://patrickarlt.com)","Gavin Rehkemper <grehkemper@esri.com> (https://gavinr.com)","Jacob Wasilkowski (https://jwasilgeo.github.io)","George Owen (https://geowen.dev/)"];var u={url:"https://github.com/Esri/esri-leaflet-vector/issues"};var h={"esri-leaflet":">2.3.0",leaflet:"^1.5.0","maplibre-gl":"^2.0.0 || ^3.0.0 || ^4.0.0"};var m={"@rollup/plugin-commonjs":"^24.0.1","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.0.1","@rollup/plugin-terser":"^0.3.0",chai:"4.3.7","chokidar-cli":"^3.0.0",eslint:"^7.13.0","eslint-config-semistandard":"^15.0.1","eslint-config-standard":"^15.0.1","eslint-plugin-chai-friendly":"^0.6.0","eslint-plugin-import":"^2.22.1","eslint-plugin-node":"^11.1.0","eslint-plugin-promise":"^4.2.1","eslint-plugin-standard":"^4.1.0","esri-leaflet":"^3.0.0","gh-release":"^7.0.2","http-server":"^14.1.1",karma:"^6.4.1","karma-chrome-launcher":"^3.1.0","karma-coverage":"^2.2.0","karma-edgium-launcher":"github:matracey/karma-edgium-launcher","karma-firefox-launcher":"^2.1.2","karma-mocha":"^2.0.1","karma-mocha-reporter":"^2.2.5","karma-safari-launcher":"~1.0.0","karma-sinon-chai":"^2.0.2","karma-sourcemap-loader":"^0.3.8",leaflet:"^1.5.0",mkdirp:"^2.1.3",mocha:"^10.2.0","npm-run-all":"^4.1.5",rollup:"^2.79.1",semistandard:"^16.0.0",sinon:"^15.0.1","sinon-chai":"3.7.0",snazzy:"^9.0.0"};var d=["src/**/*.js","dist/*.js","dist/*.js.map","dist/*.json","index.d.ts"];var f="https://github.com/Esri/esri-leaflet-vector#readme";var g={registry:"npm",format:"es6",main:"src/EsriLeafletVector.js"};var y=["maplibre","arcgis","leaflet","leafletjs","maps"];var _="Apache-2.0";var v="dist/esri-leaflet-vector-debug.js";var b="src/EsriLeafletVector.js";var L="dist/esri-leaflet-vector-debug.js";var k="index.d.ts";var S="README.md";var w={type:"git",url:"git+https://github.com/Esri/esri-leaflet-vector.git"};var M={prebuild:"mkdirp dist",build:"rollup -c profiles/debug.js & rollup -c profiles/production.js","build-dev":"rollup -c profiles/debug.js",fix:"semistandard --fix",lint:"eslint src/**/*.js","start-watch":'chokidar src -c "npm run build"',"start-watch-dev":'chokidar src -c "npm run build-dev"',start:"run-p start-watch serve","start-dev":"run-p start-watch-dev serve",dev:"npm run start-dev",serve:"http-server -p 8765 -c-1 -o",pretest:"npm run build-dev",test:"npm run lint && karma start",release:"./scripts/release.sh"};var x={globals:["expect","L","XMLHttpRequest","sinon","xhr","proj4"]};var T={name:n,description:r,version:l,author:p,contributors:c,bugs:u,peerDependencies:h,devDependencies:m,files:d,homepage:f,"jsnext:main":"src/EsriLeafletVector.js",jspm:g,keywords:y,license:_,main:v,module:b,browser:L,types:k,readmeFilename:S,repository:w,scripts:M,semistandard:x};function getBasemapStyleUrl(t,e){if(t.includes("/"))throw new Error(t+" is a v2 style enumeration. Set version:2 to request this style");let i="https://basemaps-api.arcgis.com/arcgis/rest/services/styles/"+t+"?type=style";e&&(i=i+"&token="+e);return i}
/**
   * Utility to establish a URL for the basemap styles API v2
   *
   * @param {string} style
   * @param {string} token
   * @param {Object} [options] Optional list of options: language, worldview, or places.
   * @returns {string} the URL
   */function getBasemapStyleV2Url(t,e,i){if(t.includes(":"))throw new Error(t+" is a v1 style enumeration. Set version:1 to request this style");let s="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/styles/";if(t.startsWith("osm/")||t.startsWith("arcgis/")||t.length!==32)s+=t;else{s=s+"items/"+t;if(i.language)throw new Error("The 'language' parameter is not supported for custom basemap styles")}if(!e)throw new Error("A token is required to access basemap styles.");s=s+"?token="+e;i.language&&(s=s+"&language="+i.language);i.worldview&&(s=s+"&worldview="+i.worldview);i.places&&(s=s+"&places="+i.places);return s}function loadStyle(t,e,i){const s=/^https?:\/\//;const o=/\/VectorTileServer\/?$/;if(s.test(t)&&o.test(t)){const s=t;loadStyleFromService(s,e,i)}else{const s=t;loadStyleFromItem(s,e,i)}}function loadService(t,i,s){const o=i.token?{token:i.token}:{};e.request(t,o,s)}function loadItem(t,i,s){const o=i.token?{token:i.token}:{};const n=i.portalUrl+"/sharing/rest/content/items/"+t;e.request(n,o,s)}function loadStyleFromItem(t,e,i){const s=e.portalUrl+"/sharing/rest/content/items/"+t+"/resources/styles/root.json";loadStyleFromUrl(s,e,(function(o,n){loadItem(t,e,o?function(t,s){t?i(t):loadStyleFromService(s.url,e,i)}:function(t,o){t?i(t):loadService(o.url,e,(function(t,e){i(t,n,s,e,o.url)}))})}))}function loadStyleFromService(t,e,i){loadService(t,e,(function(s,o){if(s){i(s);return}let n=t;t.charAt(t.length-1)==="/"&&(n=t.slice(0,t.length-1));let a;a=o.defaultStyles.charAt(0)==="/"?n+o.defaultStyles+"/root.json":n+"/"+o.defaultStyles+"/root.json";loadStyleFromUrl(a,e,(function(e,s){e?i(e):i(null,s,a,o,t)}))}))}function loadStyleFromUrl(t,i,s){const o=i.token?{token:i.token}:{};e.request(t,o,s)}function isSameTLD(t,e){return new URL(t).hostname===new URL(e).hostname}function formatStyle(t,e,i,s){const o=Object.keys(t.sources);for(let n=0;n<o.length;n++){const a=t.sources[o[n]];a.url.indexOf("http")===-1&&(a.url=e.replace("/resources/styles/root.json",""));a.url.charAt(a.url.length-1)==="/"&&(a.url=a.url.slice(0,a.url.length-1));if(!a.tiles){i.tiles&&i.tiles[0].charAt(0)!=="/"&&(i.tiles[0]="/"+i.tiles[0]);a.tiles=[a.url+i.tiles[0]]}a.url+="?f=json";a.url+=s?"&token="+s:"";a.tiles[0]+=s?"?token="+s:"";a.minzoom=i.minLOD||i.tileInfo.lods[0].level;a.maxzoom=i.maxLOD||i.tileInfo.lods[i.tileInfo.lods.length-1].level}const n=t.sources[o[o.length-1]];n.attribution=i.copyrightText||"";n.copyrightText=i.copyrightText||"";for(let e=0;e<t.layers.length;e++){const i=t.layers[e];i.layout&&i.layout["text-font"]&&i.layout["text-font"].length>1&&(i.layout["text-font"]=[i.layout["text-font"][0]])}t.sprite&&t.sprite.indexOf("http")===-1&&(t.sprite=e.replace("styles/root.json",t.sprite.replace("../","")));t.sprite&&s&&(isSameTLD(e,t.sprite)?t.sprite+="?token="+s:console.warn("Passing a token but sprite URL is not on same base URL, so you must pass the token manually."));t.glyphs&&t.glyphs.indexOf("http")===-1&&(t.glyphs=e.replace("styles/root.json",t.glyphs.replace("../","")));t.glyphs&&s&&(isSameTLD(e,t.glyphs)?t.glyphs+="?token="+s:console.warn("Passing a token but glyph URL is not on same base URL, so you must pass the token manually."));return t}function getAttributionData(t,s){e.Support.cors&&e.request(t,{},(function(t,o){if(t)return;s._esriAttributions=s._esriAttributions||[];for(let t=0;t<o.contributors.length;t++){const e=o.contributors[t];for(let t=0;t<e.coverageAreas.length;t++){const o=e.coverageAreas[t];const n=i.latLng(o.bbox[0],o.bbox[1]);const a=i.latLng(o.bbox[2],o.bbox[3]);s._esriAttributions.push({attribution:e.attribution,score:o.score,bounds:i.latLngBounds(n,a),minZoom:o.zoomMin,maxZoom:o.zoomMax})}}s._esriAttributions.sort((function(t,e){return e.score-t.score}));const n={target:s};e.Util._updateMapAttribution(n)}))}const A=[3857,102100,102113];function isWebMercator(t){return A.indexOf(t)>=0}var z={formatStyle:formatStyle};const setRTLTextPlugin=(t,e,i)=>{o.default.setRTLTextPlugin(t,e,i)};var U=i.Layer.extend({options:{updateInterval:32,padding:.1,interactive:false,pane:"tilePane"},initialize:function(t){i.setOptions(this||a,t);(this||a)._throttledUpdate=i.Util.throttle((this||a)._update,(this||a).options.updateInterval,this||a)},onAdd:function(t){(this||a)._container||this._initContainer();const e=this.getPaneName();t.getPane(e).appendChild((this||a)._container);this._initGL();(this||a)._offset=(this||a)._map.containerPointToLayerPoint([0,0]);t.options.zoomAnimation&&i.DomEvent.on(t._proxy,i.DomUtil.TRANSITION_END,(this||a)._transitionEnd,this||a)},onRemove:function(t){(this||a)._map._proxy&&(this||a)._map.options.zoomAnimation&&i.DomEvent.off((this||a)._map._proxy,i.DomUtil.TRANSITION_END,(this||a)._transitionEnd,this||a);const e=this.getPaneName();t.getPane(e).removeChild((this||a)._container);(this||a)._container=null;(this||a)._glMap.remove();(this||a)._glMap=null},getEvents:function(){return{move:(this||a)._throttledUpdate,zoomanim:(this||a)._animateZoom,zoom:(this||a)._pinchZoom,zoomstart:(this||a)._zoomStart,zoomend:(this||a)._zoomEnd,resize:(this||a)._resize}},getMaplibreMap:function(){return(this||a)._glMap},getCanvas:function(){return(this||a)._glMap.getCanvas()},getSize:function(){return(this||a)._map.getSize().multiplyBy(1+(this||a).options.padding*2)},getOpacity:function(){return(this||a).options.opacity},setOpacity:function(t){(this||a).options.opacity=t;(this||a)._container.style.opacity=t},getBounds:function(){const t=this.getSize().multiplyBy(.5);const e=(this||a)._map.latLngToContainerPoint((this||a)._map.getCenter());return i.latLngBounds((this||a)._map.containerPointToLatLng(e.subtract(t)),(this||a)._map.containerPointToLatLng(e.add(t)))},getContainer:function(){return(this||a)._container},getPaneName:function(){return(this||a)._map.getPane((this||a).options.pane)?(this||a).options.pane:"tilePane"},_resize:function(){return(this||a)._glMap._resize},_initContainer:function(){if((this||a)._container)return;(this||a)._container=i.DomUtil.create("div","leaflet-gl-layer");const t=this.getSize();const e=(this||a)._map.getSize().multiplyBy((this||a).options.padding);(this||a)._container.style.width=t.x+"px";(this||a)._container.style.height=t.y+"px";const s=(this||a)._map.containerPointToLayerPoint([0,0]).subtract(e);i.DomUtil.setPosition((this||a)._container,s)},_initGL:function(){if((this||a)._glMap)return;const t=(this||a)._map.getCenter();const e=i.extend({},(this||a).options,{container:(this||a)._container,center:[t.lng,t.lat],zoom:(this||a)._map.getZoom()-1,attributionControl:false});(this||a)._glMap=new o.default.Map(e);(this||a)._glMap.once("styledata",function(t){this.fire("styleLoaded")}.bind(this||a));(this||a)._glMap.transform.latRange=null;(this||a)._glMap.transform.maxValidLatitude=Infinity;this._transformGL((this||a)._glMap);(this||a)._glMap._canvas.canvas?(this||a)._glMap._actualCanvas=(this||a)._glMap._canvas.canvas:(this||a)._glMap._actualCanvas=(this||a)._glMap._canvas;const s=(this||a)._glMap._actualCanvas;i.DomUtil.addClass(s,"leaflet-image-layer");i.DomUtil.addClass(s,"leaflet-zoom-animated");(this||a).options.interactive&&i.DomUtil.addClass(s,"leaflet-interactive");(this||a).options.className&&i.DomUtil.addClass(s,(this||a).options.className)},_update:function(t){(this||a)._offset=(this||a)._map.containerPointToLayerPoint([0,0]);if((this||a)._zooming)return;const e=this.getSize();const s=(this||a)._container;const o=(this||a)._glMap;const n=(this||a)._map.getSize().multiplyBy((this||a).options.padding);const r=(this||a)._map.containerPointToLayerPoint([0,0]).subtract(n);i.DomUtil.setPosition(s,r);this._transformGL(o);if(o.transform.width!==e.x||o.transform.height!==e.y){s.style.width=e.x+"px";s.style.height=e.y+"px";o._resize!==null&&o._resize!==void 0?o._resize():o.resize()}else o._update!==null&&o._update!==void 0?o._update():o.update()},_transformGL:function(t){const e=(this||a)._map.getCenter();const i=t.transform;i.center=o.default.LngLat.convert([e.lng,e.lat]);i.zoom=(this||a)._map.getZoom()-1},_pinchZoom:function(t){(this||a)._glMap.jumpTo({zoom:(this||a)._map.getZoom()-1,center:(this||a)._map.getCenter()})},_animateZoom:function(t){const e=(this||a)._map.getZoomScale(t.zoom);const s=(this||a)._map.getSize().multiplyBy((this||a).options.padding*e);const o=this.getSize()._divideBy(2);const n=(this||a)._map.project(t.center,t.zoom)._subtract(o)._add((this||a)._map._getMapPanePos().add(s))._round();const r=(this||a)._map.project((this||a)._map.getBounds().getNorthWest(),t.zoom)._subtract(n);i.DomUtil.setTransform((this||a)._glMap._actualCanvas,r.subtract((this||a)._offset),e)},_zoomStart:function(t){(this||a)._zooming=true},_zoomEnd:function(){const t=(this||a)._map.getZoomScale((this||a)._map.getZoom());i.DomUtil.setTransform((this||a)._glMap._actualCanvas,null,t);(this||a)._zooming=false;this._update()},_transitionEnd:function(t){i.Util.requestAnimFrame((function(){const t=(this||a)._map.getZoom();const e=(this||a)._map.getCenter();const s=(this||a)._map.latLngToContainerPoint((this||a)._map.getBounds().getNorthWest());i.DomUtil.setTransform((this||a)._glMap._actualCanvas,s,1);(this||a)._glMap.once("moveend",i.Util.bind((function(){this._zoomEnd()}),this||a));(this||a)._glMap.jumpTo({center:e,zoom:t-1})}),this||a)}});function maplibreGLJSLayer(t){return new U(t)}var E=i.Layer.extend({options:{portalUrl:"https://www.arcgis.com",preserveDrawingBuffer:false},
/**
     * Populates "this.options" to be used in the rest of the module and creates the layer instance.
     *
     * @param {string} key an ITEM ID or SERVICE URL
     * @param {object} options optional
     */
initialize:function(t,e){e&&i.setOptions(this||a,e);(this||a).options.apiKey&&((this||a).options.apikey=(this||a).options.apiKey);(this||a).options.apikey?(this||a).options.token=(this||a).options.apikey:(this||a).options.token&&((this||a).options.apikey=(this||a).options.token);if(!t)throw new Error("An ITEM ID or SERVICE URL is required for vectorTileLayer.");t&&((this||a).options.key=t);this._createLayer()},_createLayer:function(){loadStyle((this||a).options.key,(this||a).options,function(t,e,i,s){if(t)this.fire("load-error",{value:t});else{isWebMercator(s.tileInfo.spatialReference.wkid)||console.warn('This layer is not guaranteed to display properly because its service does not use the Web Mercator projection. The "tileInfo.spatialReference" property is:',s.tileInfo.spatialReference,"\nMore information is available at https://github.com/maplibre/maplibre-gl-js/issues/168 and https://github.com/Esri/esri-leaflet-vector/issues/94.");e=formatStyle(e,i,s,(this||a).options.token);this._createMaplibreLayer(e)}}.bind(this||a))},_setupAttribution:function(){if(!this.getAttribution()){const t=(this||a)._maplibreGL.getMaplibreMap().style.stylesheet.sources;const e=Object.keys(t);(this||a).options.attribution=t[e[e.length-1]].attribution;(this||a)._map&&(this||a)._map.attributionControl&&(this||a)._map.attributionControl.addAttribution(this.getAttribution())}},_createMaplibreLayer:function(t){(this||a)._maplibreGL=maplibreGLJSLayer({style:t,pane:(this||a).options.pane,opacity:(this||a).options.opacity,preserveDrawingBuffer:(this||a).options.preserveDrawingBuffer});(this||a)._ready=true;this.fire("ready",{},true);(this||a)._maplibreGL.on("styleLoaded",function(){this._setupAttribution();(this||a).options.style&&typeof(this||a).options.style==="function"&&(this||a)._maplibreGL._glMap.setStyle((this||a).options.style((this||a)._maplibreGL._glMap.getStyle()))}.bind(this||a))},onAdd:function(t){(this||a)._map=t;(this||a)._ready?this._asyncAdd():this.once("ready",(function(){this._asyncAdd()}),this||a)},onRemove:function(t){t.removeLayer((this||a)._maplibreGL)},_asyncAdd:function(){const t=(this||a)._map;(this||a)._maplibreGL.addTo(t,this||a)}});function vectorTileLayer(t,e){return new E(t,e)}var j=E.extend({
/**
     * Populates "this.options" to be used in the rest of the module.
     *
     * @param {string} key
     * @param {object} options optional
     */
initialize:function(t,e){e.version||(t.includes("/")?e.version=2:e.version=1);t||(t=e.version===1?"ArcGIS:Streets":"arcgis/streets");if(!(e.apikey||e.apiKey||e.token))throw new Error("An API Key or token is required for vectorBasemapLayer.");if(e.version!==2){if(e.language)throw new Error("The language parameter is only supported by the basemap styles service v2. Provide a v2 style enumeration to use this option.");if(e.worldview)throw new Error("The worldview parameter is only supported by the basemap styles service v2. Provide a v2 style enumeration to use this option.");if(e.places)throw new Error("The places parameter is only supported by the basemap styles service v2. Provide a v2 style enumeration to use this option.")}e.pane||(t.includes(":Label")||t.includes("/label")?e.pane="esri-labels":t.includes(":Detail")||t.includes("/detail")?e.pane="esri-detail":e.pane="tilePane");E.prototype.initialize.call(this||a,t,e)},_createLayer:function(){let t;t=(this||a).options.version&&(this||a).options.version===2?getBasemapStyleV2Url((this||a).options.key,(this||a).options.apikey,{language:(this||a).options.language,worldview:(this||a).options.worldview,places:(this||a).options.places}):getBasemapStyleUrl((this||a).options.key,(this||a).options.apikey);this._createMaplibreLayer(t)},_setupAttribution:function(){e.Util.setEsriAttribution((this||a)._map);if((this||a).options.key.length===32){const t=(this||a)._maplibreGL.getMaplibreMap().style.stylesheet.sources;const e=[];Object.keys(t).forEach((function(i){e.push(t[i].attribution);t[i].copyrightText&&t[i].copyrightText&&t[i].copyrightText!==""&&t[i].attribution!==t[i].copyrightText&&e.push(t[i].copyrightText)}));(this||a)._map.attributionControl.addAttribution(`<span class="esri-dynamic-attribution">${e.join(", ")}</span>`)}else{(this||a).options.attributionUrls||((this||a).options.attributionUrls=this._getAttributionUrls((this||a).options.key));if((this||a)._map&&(this||a).options.attributionUrls){if((this||a)._map.attributionControl){for(let t=0;t<(this||a).options.attributionUrls.length;t++){const e=(this||a).options.attributionUrls[t];getAttributionData(e,(this||a)._map)}(this||a)._map.attributionControl.addAttribution('<span class="esri-dynamic-attribution"></span>')}e.Util._updateMapAttribution({target:(this||a)._map})}}},
/**
     * Given a key, return the attribution url(s).
     * @param {string} key
     */
_getAttributionUrls:function(t){return t.indexOf("OSM:")===0||t.indexOf("osm/")===0?["https://static.arcgis.com/attribution/Vector/OpenStreetMap_v2"]:t.indexOf("ArcGIS:Imagery")===0||t.indexOf("arcgis/imagery")===0?["https://static.arcgis.com/attribution/World_Imagery","https://static.arcgis.com/attribution/Vector/World_Basemap_v2"]:["https://static.arcgis.com/attribution/Vector/World_Basemap_v2"]},_initPane:function(){if(!(this||a)._map.getPane((this||a).options.pane)){const t=(this||a)._map.createPane((this||a).options.pane);t.style.pointerEvents="none";let e=500;(this||a).options.pane==="esri-detail"?e=250:(this||a).options.pane==="esri-labels"&&(e=300);t.style.zIndex=e}},onRemove:function(t){t.off("moveend",e.Util._updateMapAttribution);t.removeLayer((this||a)._maplibreGL);if(t.attributionControl){e.Util.removeEsriAttribution&&e.Util.removeEsriAttribution(t);const i=document.getElementsByClassName("esri-dynamic-attribution");if(i&&i.length>0){const e=i[0].outerHTML;t.attributionControl.removeAttribution(e);t.attributionControl.removeAttribution('<span class="esri-dynamic-attribution"></span>')}}},_asyncAdd:function(){const t=(this||a)._map;this._initPane();t.on("moveend",e.Util._updateMapAttribution);(this||a)._maplibreGL.addTo(t,this||a)}});function vectorBasemapLayer(t,e){return new j(t,e)}const P=T.version;t.MaplibreGLJSLayer=U;t.Util=z;t.VERSION=P;t.VectorBasemapLayer=j;t.VectorTileLayer=E;t.maplibreGLJSLayer=maplibreGLJSLayer;t.setRTLTextPlugin=setRTLTextPlugin;t.vectorBasemapLayer=vectorBasemapLayer;t.vectorTileLayer=vectorTileLayer;Object.defineProperty(t,"__esModule",{value:true})}));const l=r.MaplibreGLJSLayer,p=r.Util,c=r.VERSION,u=r.VectorBasemapLayer,h=r.VectorTileLayer,m=r.maplibreGLJSLayer,d=r.setRTLTextPlugin,f=r.vectorBasemapLayer,g=r.vectorTileLayer,y=r.__esModule;export{l as MaplibreGLJSLayer,p as Util,c as VERSION,u as VectorBasemapLayer,h as VectorTileLayer,y as __esModule,r as default,m as maplibreGLJSLayer,d as setRTLTextPlugin,f as vectorBasemapLayer,g as vectorTileLayer};

